<!doctype html>
<html lang="en" class="h-100">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <title>ME</title>

  <!-- Bootstrap core CSS -->
  <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,400i,700" rel="stylesheet">
  <link href="//fonts.googleapis.com/css?family=Roboto:700" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link href="bootstrap.css" rel="stylesheet">
  <link href="blog.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/marked@1.2.5/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.4.0/build/highlight.min.js"></script>

  <script type="text/javascript">
    function blink() {
      var blinks = document.getElementsByTagName('blink');
      for (var i = blinks.length - 1; i >= 0; i--) {
        var s = blinks[i];
        s.style.visibility = (s.style.visibility === 'visible') ? 'hidden' : 'visible';
      }
      window.setTimeout(blink, 600);
    }
    if (document.addEventListener) document.addEventListener("DOMContentLoaded", blink, false);
    else if (window.addEventListener) window.addEventListener("load", blink, false);
    else if (window.attachEvent) window.attachEvent("onload", blink);
    else window.onload = blink;
  </script>
</head>

<body class="home blog">

  <div class="container">
    <a href="https://www.ae3e.com/blog">
      <div class="blackbox">
        <span class="blog-title">&gt; Hello</span><br />
        <span class="blog-title">&gt; This is my lifelog </span>
        <span class="blog-title hidden-sm-up"><br />&gt; </span>
        <span class="blog-title">and digital playground</span>
        <blink><span class="cursor">&nbsp;</span></blink>
      </div>
    </a>


    <div class="blog-post">

      <!--<span class="blog-post-title">Live Tracking</span>-->
      <div id="root" class="blog-post-text">

      </div>
      <script type="module">

        //http://localhost:8080/blog/notebook.html?id=2b6b4376067a377b&cells=intro;viewof%20map;profil&fitWidth=part2
        //http://localhost:8080/blog/notebook.html?id=d196da0f4af791f7

        //import define from "https://api.observablehq.com/d/2b6b4376067a377b.js?v=3";
        //console.log(define);
        import { Runtime, Inspector, Library } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";
        (async () => {
          //let {Runtime, Inspector, Library} = await import("https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js");

          let id = new URL(location.href).searchParams.get('id');

          //import define from "https://api.observablehq.com/d/2b6b4376067a377b.js?v=3";
          let def = await import('https://api.observablehq.com/d/' + id + '.js?v=3');
          let define = def.default
          console.log(Runtime)
          console.log(Inspector)
          console.log(Library)
          console.log(define)
          let cells = new URL(location.href).searchParams.get('cells')?.split(';');

          console.log(cells)
          if (cells) {
            let root = document.querySelector("#root");
            cells.forEach((cell, i) => {
              let div = document.createElement('div');
              div.id = 'part' + i;

              root.appendChild(div);
            });

            const stdlib = new Library;


            let fitWidth = new URL(location.href).searchParams.get('fitWidth');
            console.log(fitWidth)
            if (fitWidth) {
              const test = document.querySelector('#' + fitWidth);

              const library = Object.assign({}, stdlib, { width });

              function width() {
                return stdlib.Generators.observe(notify => {
                  let width = notify(test.clientWidth);

                  function resized() {
                    let width1 = test.clientWidth;
                    if (width1 !== width) notify(width = width1);
                  }

                  window.addEventListener("resize", resized);
                  return () => window.removeEventListener("resize", resized);
                });
              }
              new Runtime(library).module(define, name => {
                let i = cells.indexOf(name)
                if (i != -1) {
                  return new Inspector(document.querySelector("#part" + i));
                }
              })

            } else {
              new Runtime(stdlib).module(define, name => {
                let i = cells.indexOf(name)
                if (i != -1) {
                  return new Inspector(document.querySelector("#part" + i));
                }
              })
            }



          } else {
            new Runtime().module(define, Inspector.into(document.querySelector("#root")))
          }
        })()

        isAdmin(localStorage.getItem('token')).then(data => {
          if (data.admin) {
            let id = new URL(location.href).searchParams.get('id');
            document.getElementById('edit').innerHTML = `Edit - <a href="https://observablehq.com/d/${id}" target="_blank">${id}</a>`
          }
        })
      </script>
      <div class="blog-post-bottom meta"><span id='edit'></span></div>
    </div>
    <div>
      <script src="script.js"></script>

</html>